#!/usr/bin/env coffee --nodejs --max-old-space-size=4096

fs = require('fs')
path = require('path')
Perceptron = require('../lib/perceptron')
Viterbi = require('../lib/viterbi')
SparseVector = require('../lib/vector')
Featurizer = require('../lib/featurizer')
Morpheus = require('../lib/morpheus')
Labelizer = require('../lib/labelizer')
Scorer = require('../lib/scorer')

MAX_TABLE_WIDTH = 193

sentence = process.argv[2..]

allLabels = JSON.parse(fs.readFileSync(path.join(__dirname, '../resources/labels.json')))
nounLabels = ('proper-' + label for label in allLabels when /^noun/.test(label))
morpheus = new Morpheus(
  JSON.parse(fs.readFileSync(path.join(__dirname, '../build/morpheus.accentuated.json'))),
  JSON.parse(fs.readFileSync(path.join(__dirname, '../build/morpheus.unaccentuated.json'))))

featurizer = new Featurizer(morpheus)
labelizer = new Labelizer(morpheus, nounLabels)
v = new SparseVector(JSON.parse(fs.readFileSync(path.join(__dirname, '../build/seed.json'))))
console.warn("#{new Date()}\tDone loading databases.")

scorer = new Scorer(v, featurizer)
viterbi = new Viterbi(scorer, 180)

labels = viterbi.label(sentence, (labelizer.labelize(sentence, i) for token, i in sentence))
console.log([token, labels[i]] for token, i in sentence)
